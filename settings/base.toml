[server]
addr = "0.0.0.0"
port = 8080

[server.tls]
enabled = false
cert_path = "/etc/letsencrypt/live/example.com/fullchain.pem"
key_path = "/etc/letsencrypt/live/example.com/privkey.pem"

[server.acme]
enabled = false
domains = []
contact_emails = []
cache_dir = "/var/lib/zm_api/acme"
production = false
challenge = "tls-alpn-01"
http_port = 80

# Database configuration
# By default, uses ZoneMinder's zm.conf settings (/etc/zm/zm.conf + conf.d/)
# Override here or via environment variables (APP_DB__HOST, etc.) if needed
[db]
# These placeholder values trigger zm.conf fallback
host = "localhost"
port = 3306
username = "username"
password = "password"
database_name = "database_name"
max_connections = 5

[sentry]
# Sentry error reporting - disabled by default for privacy
# Users can enable and provide their own DSN if desired
enabled = false
dsn = ""

[env]
RUST_LOG = "info"
[secret]
private_access_key = "static/key/private_access_rsa_key.pem"
public_access_key = "static/key/public_access_rsa_key.pem"
private_refresh_key = "static/key/private_refresh_rsa_key.pem"
public_refresh_key = "static/key/public_refresh_rsa_key.pem"

[http]
timeout = 10

# Streaming configuration for RTSP/WebRTC/HLS/MSE
[streaming]
enabled = true
default_protocol = "auto"

[streaming.source]
priority = ["fifo", "rtsp", "go2rtc"]
prefer_direct_rtsp = false
fallback_to_go2rtc = true
cache_sdp_seconds = 300

[streaming.zoneminder]
enabled = true
fifo_base_path = "/run/zm"
video_fifo_suffix = "/video_fifo_"
audio_fifo_suffix = "/audio_fifo_"
fifo_read_timeout_ms = 5000
reconnect_delay_ms = 1000

[streaming.go2rtc]
enabled = false
base_url = "http://localhost:1984"
timeout_seconds = 10
auto_register = true
health_check_interval_seconds = 30
retry_attempts = 3

[streaming.webrtc]
enabled = true
mode = "go2rtc"
max_connections = 100
connection_timeout_seconds = 30
stun_servers = ["stun:stun.l.google.com:19302", "stun:stun1.l.google.com:19302"]

[streaming.hls]
enabled = true
segment_duration_seconds = 2
playlist_size = 10
ll_hls_enabled = false
partial_segment_ms = 200

[streaming.hls.storage]
path = "/tmp/hls"
retention_minutes = 60

[streaming.mse]
enabled = true
mode = "native"
max_buffer_segments = 20
segment_duration_ms = 1000

[streaming.rtsp_proxy]
enabled = false
port = 8554
rtp_port_range_start = 20000
rtp_port_range_end = 30000
max_sessions = 100
transport = "auto"

# Daemon controller configuration (replaces zmdc.pl/zmpkg.pl)
[daemon]
enabled = true
socket_path = "/run/zm"
socket_name = "zmdc.sock"
# On Ubuntu/Debian, both binaries and scripts are in /usr/bin
bin_path = "/usr/bin"
script_path = "/usr/bin"
min_backoff_seconds = 5
max_backoff_seconds = 900
shutdown_timeout_seconds = 30
stats_update_interval_seconds = 60
enable_socket_ipc = true
enable_rest_api = true
